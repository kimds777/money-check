<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.money.moneycheck.mapper.ExpenseMapper">
    <select id="getExpensesList" resultType="map">
        SELECT
            u.nickname, me.expenditure_id, ag.name as asset_name, ec."name" as expenditure_class_name,
            me.amount, me.expenditure_at, me."content"
        FROM money_check.monthly_expenditure_2503 me
                 JOIN money_check.users u ON u.user_id = me.user_id
                 JOIN money_check.asset_group ag ON ag.asset_id = me.asset_id
                 JOIN money_check.expenditure_classification ec ON ec.expenditure_class_id  = me.expenditure_class_id
        WHERE me.is_active = true
            AND me.user_id = 1 -- #{userId}
            <if test = "searchWord != null">
                AND me.content LIKE '%' || #{searchWord} || '%'
            </if>
    </select>
</mapper>